	<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.15" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>pythonのテストにpytestを使ってみた - I Will Survive</title>

  
  <link rel="stylesheet" href="http://blog.restartr.com/css/poole.css">
  <link rel="stylesheet" href="http://blog.restartr.com/css/syntax.css">
  <link rel="stylesheet" href="http://blog.restartr.com/css/hyde.css">
  <link rel="stylesheet" href="http://blog.restartr.com/css/custom.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://blog.restartr.com/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="http://blog.restartr.com/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="I Will Survive" />
</head>

	<body class="theme-base-0d">
		<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="http://blog.restartr.com/"><h1>I Will Survive</h1></a>
      <p class="lead">
       An application depelopper&#39;s blog. 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="http://blog.restartr.com/">Home</a> </li>
      
        <li><a href="http://blog.restartr.com/about/"> About </a></li>
      
        <li><a href="http://blog.restartr.com/index.xml"> Feed </a></li>
      
        <li><a href="https://github.com/ReSTARTR"> GitHub </a></li>
      
        <li><a href="https://twitter.com/ReSTARTR"> Twitter </a></li>
      
    </ul>

    <p>Copyright ©2016 - ReSTARTR. All rights reserved.</p>
  </div>
</div>


		<div class="content container">
			<div class="post">
			 	<h1>pythonのテストにpytestを使ってみた</h1>
        <span class="post-date">2013-04-05(Fri) - [python]</span>
			  <div class="sharing">
  <ul>
  <li><a href="http://blog.restartr.com/2013/04/05/my-first-pytest" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard" title="このエントリーをはてな>ブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script></li>
  <li><a href="http://twitter.com/share" class="twitter-share-button" data-url="http://blog.restartr.com/2013/04/05/my-first-pytest" data-via="ReSTARTR" data-counturl="http://blog.restartr.com/2013/04/05/my-first-pytest" >Tweet</a></li>
  <li><a data-pocket-label="pocket" data-pocket-count="horizontal" class="pocket-btn" data-lang="en"></a><script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script></li>
  </ul>
</div>
<script type="text/javascript">
  (function(){
    var twitterWidgets = document.createElement('script');
    twitterWidgets.type = 'text/javascript';
    twitterWidgets.async = true;
    twitterWidgets.src = '//platform.twitter.com/widgets.js';
    document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
  })();
</script>
<hr />

			      

<p>pytestを使い始めました。</p>

<ul>
<li><a href="http://pytest.org/latest/">pytest: helps you write better programs</a></li>
</ul>

<p>まだまだ機能は把握しきれていませんが、良いと思ったことは3つ。</p>

<ol>
<li>テストがコケた箇所のコードがレポート内容に表示される</li>
<li>テスト対象を初期化したものの受け渡し方をスマートにできる</li>
<li>pytest.vimがなかなか使える</li>
</ol>

<h3 id="1-テストがコケた箇所のコードがレポート内容に表示される:84ce8863de1c6ec192d784ff5bac5615">1.テストがコケた箇所のコードがレポート内容に表示される</h3>

<p>これが巷でよく聞く一番のメリットかとは思いますが、コケたときの情報が全然違います。
pytestはかなり詳細に表示してくれるので、レポートの内容だけでどこをどう直せば良いか把握できます。</p>

<h4 id="unittestの実行結果-vオプション付き:84ce8863de1c6ec192d784ff5bac5615">unittestの実行結果(-vオプション付き)</h4>

<p><a href="http://www.flickr.com/photos/53244662@N04/8621946368/" title="unittest by ReSTARTR_y, on Flickr"><img src="http://farm9.staticflickr.com/8523/8621946368_d7bc9a450d_z.jpg" width="640" height="220" alt="unittest"></a></p>

<h4 id="pytestの実行結果-vオプション付き:84ce8863de1c6ec192d784ff5bac5615">pytestの実行結果(-vオプション付き)</h4>

<p><a href="http://www.flickr.com/photos/53244662@N04/8620844529/" title="pytest by ReSTARTR_y, on Flickr"><img src="http://farm9.staticflickr.com/8244/8620844529_ce66ff7f9c_z.jpg" width="640" height="401" alt="pytest"></a></p>

<p>文字列比較の場合は差分表示してくれたりするので便利です。</p>

<h3 id="2-テスト対象を初期化したものの受け渡し方をスマートにできる:84ce8863de1c6ec192d784ff5bac5615">2. テスト対象を初期化したものの受け渡し方をスマートにできる</h3>

<p>これが結構良い感じだと思いました。</p>

<p>かなり単純なクラスを対象にして例を書きます。</p>

<pre><code class="language-python"># -*- coding: utf-8 -*-

class Hoge(object):

    def __init__(self, v):
        self.val = v

    def update(self, v):
        self.val = v
</code></pre>

<h4 id="python同梱のunittestで書く:84ce8863de1c6ec192d784ff5bac5615">python同梱のunittestで書く</h4>

<p>こんな感じで、self.hogeを使ってテスト対象を受け渡します。</p>

<pre><code class="language-python"># -*- coding: utf-8 -*-
from hoge import Hoge
import unittest

class TestHoge1(unittest.TestCase):

    def setUp(self):
        self.hoge = Hoge(1)

    def test_type(self):
        self.assertIsInstance(self.hoge, Hoge)

    def test_val(self):
        self.assertEqual(self.hoge.val, 1)

        self.hoge.update('hoge')
        self.assertEqual(self.hoge.val, 'hige')

if __name__ == '__main__':
    unittest.main()
</code></pre>

<p>pytestで書くとこんな感じになります。</p>

<pre><code class="language-python"># -*- coding: utf-8 -*-
from hoge import Hoge
import pytest

class TestHoge1(object):

    def pytest_funcarg__hoge(request):
        return Hoge(1)

    def test_type(self, hoge):
        assert isinstance(hoge, Hoge)

    def test_val(self, hoge):
        assert hoge.val == 1

        hoge.update('hoge')
        assert hoge.val == 'hige'

if __name__ == '__main__':
    pytest.main()
</code></pre>

<p>何が良いかっていうと、各テストメソッドで必要な初期化済みHogeインスタンスを、pytest_funcarg<strong>hoge()で作って渡してやることができます。pytest_funcarg</strong>NAMEを定義すれば、各テストメソッドでNAMEとして引数にとることができるわけです。(<a href="http://pytest.org/latest-ja/funcargs.html">テスト関数 (funcargs) にオブジェクトを注入</a>)</p>

<p>unittest.TestCaseのsetUpを使う場合、self.hogeに一旦入れてやらないといけないし、各テストメソッドではself.hogeでアクセスする必要も出てきます。</p>

<p>見た目が簡潔になるのはとても良いことです。</p>

<h3 id="3-pytest-vimがなかなか使える:84ce8863de1c6ec192d784ff5bac5615">3. pytest.vimがなかなか使える</h3>

<p>vimのプラグインにpytest.vimっていうのがありました。
これもなかなか使い勝手が良いです。</p>

<p>詳しくは下記動画を御覧ください。</p>

<ul>
<li><a href="http://vimeo.com/19774046"> pytest.vim 0.0.5 on Vimeo </a></li>
</ul>

<p>pytestの概要は以下スライドにて。</p>

<p><iframe src="http://www.slideshare.net/slideshow/embed_code/14006990" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe>
<div style="margin-bottom:5px"> <strong> <a href="http://www.slideshare.net/pfctdayelise/funcargs-other-fun-with-pytest" title="Funcargs &amp; other fun with pytest" target="_blank">Funcargs &amp; other fun with pytest</a> </strong> from <strong><a href="http://www.slideshare.net/pfctdayelise" target="_blank">Brianna Laugher</a></strong> </div>
他の機能は触りながらおいおい掴んでいければなと。</p>

			  <div class="sharing">
  <ul>
  <li><a href="http://blog.restartr.com/2013/04/05/my-first-pytest" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard" title="このエントリーをはてな>ブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script></li>
  <li><a href="http://twitter.com/share" class="twitter-share-button" data-url="http://blog.restartr.com/2013/04/05/my-first-pytest" data-via="ReSTARTR" data-counturl="http://blog.restartr.com/2013/04/05/my-first-pytest" >Tweet</a></li>
  <li><a data-pocket-label="pocket" data-pocket-count="horizontal" class="pocket-btn" data-lang="en"></a><script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script></li>
  </ul>
</div>
<script type="text/javascript">
  (function(){
    var twitterWidgets = document.createElement('script');
    twitterWidgets.type = 'text/javascript';
    twitterWidgets.async = true;
    twitterWidgets.src = '//platform.twitter.com/widgets.js';
    document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
  })();
</script>
<hr />

			   <footer>
  <p class="meta">
    <ul class="params">
    <li>Category: [python]</li>
    <li class="">Tags: []</li>
    <li><span class="byline author vcard">Posted by <span class="fn">ReSTARTR</span></span></li>
    <li><time datetime="2013-04-05 21:00:24 &#43;0900 JST" pubdate data-updated="true">2013-04-05(Fri)</time></li>
    </ul>
  </p>
</footer>

			</div>

			
		</div>

  </body>
</html>
