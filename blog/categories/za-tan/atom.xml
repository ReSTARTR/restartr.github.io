<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: 雑談 | I Will Servive]]></title>
  <link href="http://blog.restartr.com/blog/categories/za-tan/atom.xml" rel="self"/>
  <link href="http://blog.restartr.com/"/>
  <updated>2014-04-06T13:15:29+09:00</updated>
  <id>http://blog.restartr.com/</id>
  <author>
    <name><![CDATA[ReSTARTR]]></name>
    <email><![CDATA[yoshida.masaki+restartr@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[WordpressからOctpressに移行]]></title>
    <link href="http://blog.restartr.com/2014/04/06/move-from-wordpress-to-octopress/"/>
    <updated>2014-04-06T13:00:00+09:00</updated>
    <id>http://blog.restartr.com/2014/04/06/move-from-wordpress-to-octopress</id>
    <content type="html"><![CDATA[<p>もともとさくらのレンサバ上でWordpressで構築していたブログをOctpressに移行してGithub Pagesでホスティングするように切り替え。
最初はJekyllだけでやろうとしたけど、ブロクとしての機能を見るとOctopressのほうが良さそうだったので途中で方針転換。</p>

<h4 id="section">手順</h4>

<p>詳細な手順は面倒なので割愛するとして、だいたいこんな感じの流れで移行。</p>

<ol>
  <li>作業用環境にjekyll, jekyll-import, mysql2, sequelをgem install</li>
  <li>さくらのレンサバ上のMySQLのデータをmysqldumpしてscp</li>
  <li>dumpデータを作業用環境のMySQLにリストア</li>
  <li>リストアしたデータから<a href="http://import.jekyllrb.com/docs/wordpress/">jekyll-import</a>を使って記事のmarkdownファイルを吐き出す</li>
  <li>octopressをcloneして、<code>rake install</code></li>
  <li>jekyll-importで吐き出されたファイルをoctopressのsource/_posts以下に移動</li>
  <li><code>rake preview</code>で表示を確認しながら、source/_posts以下のmarkdownファイルをひたすら修正</li>
  <li>テーマを調整&amp;元記事のURLパスと同一になるように<code>_config.yml</code>に設定</li>
  <li>githubにpushしてgithub pagesとして公開</li>
  <li>CNAMEを設定してgithub.ioから元のドメイン(blog.restartr.com)に移行</li>
</ol>

<p>さくらのレンサバ内からしかWordpressのDBに接続できないのと、レンサバ内でrubyを使うのはなんか面倒事が多そうだったので、環境整備済みなvpsで移行作業。</p>

<p><em>※wordpressのエクスポート機能で吐き出したxmlからmigrateする方法もあるけど今回は不採用</em></p>

<h4 id="wordpress">Wordpressの時のドメイン、パスを同一にするための設定</h4>

<p>wordpressでは<code>/year/month/day/title</code>というpermalinkを設定していたのでそれと同一にするための作業。</p>

<ul>
  <li>ドメインはgithub pagesのカスタムドメインとCNAME設定で解決</li>
  <li>パスは<code>_config.yml</code>のpermalinkを<code>/:year/:month/:day/:title</code>にして解決</li>
</ul>

<h4 id="post">postデータの修正</h4>

<p>jekyll-importを使ってmarkdownを吐き出すところまではすんなりいけたけど、なにより面倒だったのが吐き出したmarkdownを修正する作業。</p>

<ul>
  <li>シンタックスハイライトするために<code>[ccW_python]...[/ccW_python]</code>とか<code>&lt;pre class="brush:pyton"&gt;...&lt;/pre&gt;</code>とか独自タグがある</li>
  <li>amazonのリンク生成用タグ<code>[tmkm-amazon]123456[/tmkm-amazon]</code>というタグがある</li>
  <li><code>&lt;p&gt;</code>タグと<code>&lt;br /&gt;</code>タグの嵐</li>
</ul>

<p>これらの対応のためにいちいち置換するのが非常に大変。<code>[ccW]</code>と<code>[tmkm-amazon]</code>タグは置換できたけど、<code>&lt;pre class="brush:..."&gt;</code>についてはハイライトされないだけで表示上問題なさそうなので無視。
あとはmarkdownにhtmlが混じってるのが気持ち悪いので<code>&lt;p&gt;</code>と<code>&lt;br /&gt;</code>を置換して行間を調整。</p>

<p>ドラフト記事をリモートにpushしてなくて別のPCから記事の途中からかけなくて困った…とならないように基本的にVPS上にcloneすることにした。
これで記事編集のための苦痛を感じる事無く純粋なmarkdownで記事がかけるようになる。</p>

<ul>
  <li>参考にした記事</li>
  <li><a href="http://hadihariri.com/2013/12/24/migrating-from-wordpress-to-jekyll/">Migrating from WordPress.com to Jekyll – Hadi Hariri</a></li>
  <li><a href="http://blog.glidenote.com/blog/2011/12/20/how-to-use-custom-domain-on-github-pages/">GitHub PagesでCustom Domainを利用する - Glide Note - グライドノート</a></li>
  <li>ベースにしたテーマ</li>
  <li><a href="http://carlosbecker.com/posts/up-a-jekyll-theme/">UP: A jekyll theme</a></li>
</ul>
]]></content>
  </entry>
  
</feed>
