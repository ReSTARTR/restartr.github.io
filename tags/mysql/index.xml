<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Mysql on I Will Survive</title>
    <link>http://blog.restartr.com/tags/mysql/</link>
    <description>Recent content in Mysql on I Will Survive</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Mon, 07 Apr 2014 08:12:32 +0900</lastBuildDate>
    <atom:link href="http://blog.restartr.com/tags/mysql/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>MySQLã§utf8mb4ã‚’æ‰±ã†å ´åˆã¯å¿…è¦ãªã‚«ãƒ©ãƒ ã¨æ¥ç¶šæ™‚ã ã‘æ˜ç¤ºçš„ã«æŒ‡å®šã™ã‚‹</title>
      <link>http://blog.restartr.com/2014/04/07/mysql-character-set-utf8mb4</link>
      <pubDate>Mon, 07 Apr 2014 08:12:32 +0900</pubDate>
      
      <guid>http://blog.restartr.com/2014/04/07/mysql-character-set-utf8mb4</guid>
      <description>

&lt;p&gt;çµè«–ã¯ã‚¿ã‚¤ãƒˆãƒ«ã®é€šã‚Šã€‚&lt;/p&gt;

&lt;h2 id=&#34;ã¾ã¨ã‚:92573dc8333c8459780952b1c4bbdcda&#34;&gt;ã¾ã¨ã‚&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;systemã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãŒ&lt;code&gt;character_set_system&lt;/code&gt;ã«åæ˜ ã•ã‚Œã‚‹. clientã®æ¥ç¶šæ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãŒä½¿ç”¨ã•ã‚Œã‚‹ï¼ˆæœªæ¤œè¨¼ï¼‰&lt;/li&gt;
&lt;li&gt;clientã®æ¥ç¶šæ™‚ã®æŒ‡å®šãŒå„ªå…ˆã•ã‚Œã‚‹ã€‚ãŸã ã—ã€&lt;code&gt;character_set_database&lt;/code&gt;, &lt;code&gt;character_set_filesystem&lt;/code&gt;, &lt;code&gt;character_set_server&lt;/code&gt;ã«ã¤ã„ã¦ã¯ä¸Šæ›¸ãã•ã‚Œãªã„ã€‚&lt;/li&gt;
&lt;li&gt;my.cnfã®&lt;code&gt;mysql.default-character-set&lt;/code&gt;ã¯æ„å‘³ã‚ã‚‹ï¼Ÿï¼ˆæœªæ¤œè¨¼ï¼‰&lt;/li&gt;
&lt;li&gt;my.cnfã®&lt;code&gt;mysqld.character-set-server&lt;/code&gt;ã¯filesystemã¨systemä»¥å¤–ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«å½±éŸ¿ã™ã‚‹ã€‚clientã®æ¥ç¶šæ™‚ã«ç„¡æŒ‡å®šã®å ´åˆã«ã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ã—ã¦åˆ©ç”¨ã•ã‚Œã‚‹&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä»¥ä¸‹ã®ç†ç”±ã«ã‚ˆã£ã¦ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯utf8ã§ã€å¿…è¦ãªã‚«ãƒ©ãƒ ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶šæ™‚ã«ã ã‘utf8mb4ã‚’é©ç”¨ã™ã‚‹ã“ã¨ã¨ã—ãŸã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ä½¿ãˆã‚‹æ–‡å­—æ•°ãŒutf8ã ã¨255æ–‡å­—ã¾ã§ã«å¯¾ã—ã¦utf8mb4ã ã¨191æ–‡å­—ã¾ã§ã€‚

&lt;ul&gt;
&lt;li&gt;ã‚µãƒ¼ãƒãƒ¼å´ã®è¨­å®šã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆutf8.ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®è¨­å®šã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆutf8mb4.ãŒè‰¯ã„&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;æ¤œè¨¼:92573dc8333c8459780952b1c4bbdcda&#34;&gt;æ¤œè¨¼&lt;/h3&gt;

&lt;p&gt;server/clientã¨ã‚‚ã«remiã®MySQL5.5ã‚’ä½¿ç”¨&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ mysql --version
mysql  Ver 14.14 Distrib 5.5.37, for Linux (x86_64) using readline 5.1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;utf8ãªã‚«ãƒ©ãƒ &lt;code&gt;name1&lt;/code&gt;ã¨ã€utf8mb4ãªã‚«ãƒ©ãƒ &lt;code&gt;name2&lt;/code&gt;ã‚’ç”¨æ„.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ mysql -uroot test -e &#39;show create table user2\G&#39;
*************************** 1. row ***************************
       Table: user2
Create Table: CREATE TABLE `user2` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name1` varchar(255) DEFAULT NULL,
  `name2` varchar(255) CHARACTER SET utf8mb4 DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=14 DEFAULT CHARSET=utf8
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®çŠ¶æ…‹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ mysql -uroot test -e &#39;show global variables like &amp;quot;character_set%&amp;quot;; show variables like &amp;quot;character_set%&amp;quot;&#39;
+--------------------------+----------------------------+
| Variable_name            | Value                      |
+--------------------------+----------------------------+
| character_set_client     | latin1                     |
| character_set_connection | latin1                     |
| character_set_database   | latin1                     |
| character_set_filesystem | binary                     |
| character_set_results    | latin1                     |
| character_set_server     | latin1                     |
| character_set_system     | utf8                       |
| character_sets_dir       | /usr/share/mysql/charsets/ |
+--------------------------+----------------------------+
+--------------------------+----------------------------+
| Variable_name            | Value                      |
+--------------------------+----------------------------+
| character_set_client     | utf8                       |
| character_set_connection | utf8                       |
| character_set_database   | latin1                     |
| character_set_filesystem | binary                     |
| character_set_results    | utf8                       |
| character_set_server     | latin1                     |
| character_set_system     | utf8                       |
| character_sets_dir       | /usr/share/mysql/charsets/ |
+--------------------------+----------------------------+
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;clientãŒ&lt;code&gt;--default-character-set=utf8mb4&lt;/code&gt;ã‚’ã¤ã‘ã¦æ¥ç¶šã—ãŸå ´åˆ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ mysql --default-character-set=utf8 -uroot test -e &#39;show global variables like &amp;quot;character_set%&amp;quot;; show variables like &amp;quot;character_set%&amp;quot;&#39;
+--------------------------+----------------------------+
| Variable_name            | Value                      |
+--------------------------+----------------------------+
| character_set_client     | latin1                     |
| character_set_connection | latin1                     |
| character_set_database   | latin1                     |
| character_set_filesystem | binary                     |
| character_set_results    | latin1                     |
| character_set_server     | latin1                     |
| character_set_system     | utf8                       |
| character_sets_dir       | /usr/share/mysql/charsets/ |
+--------------------------+----------------------------+
+--------------------------+----------------------------+
| Variable_name            | Value                      |
+--------------------------+----------------------------+
| character_set_client     | utf8                       |
| character_set_connection | utf8                       |
| character_set_database   | latin1                     |
| character_set_filesystem | binary                     |
| character_set_results    | utf8                       |
| character_set_server     | latin1                     |
| character_set_system     | utf8                       |
| character_sets_dir       | /usr/share/mysql/charsets/ |
+--------------------------+----------------------------+
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;my.cnfã«&lt;code&gt;mysql.default-character-set&lt;/code&gt;ã‚’æŒ‡å®šã—ãŸå ´åˆ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[mysql]
default-character-set=utf8
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ mysql -uroot test -e &#39;show global variables like &amp;quot;character_set%&amp;quot;; show variables like &amp;quot;character_set%&amp;quot;&#39;
+--------------------------+----------------------------+
| Variable_name            | Value                      |
+--------------------------+----------------------------+
| character_set_client     | latin1                     |
| character_set_connection | latin1                     |
| character_set_database   | latin1                     |
| character_set_filesystem | binary                     |
| character_set_results    | latin1                     |
| character_set_server     | latin1                     |
| character_set_system     | utf8                       |
| character_sets_dir       | /usr/share/mysql/charsets/ |
+--------------------------+----------------------------+
+--------------------------+----------------------------+
| Variable_name            | Value                      |
+--------------------------+----------------------------+
| character_set_client     | utf8                       |
| character_set_connection | utf8                       |
| character_set_database   | latin1                     |
| character_set_filesystem | binary                     |
| character_set_results    | utf8                       |
| character_set_server     | latin1                     |
| character_set_system     | utf8                       |
| character_sets_dir       | /usr/share/mysql/charsets/ |
+--------------------------+----------------------------+
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;my.cnfã«&lt;code&gt;mysqd.character-set-server=utf8&lt;/code&gt;ã‚’æŒ‡å®šã—ãŸå ´åˆ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[mysqld]
character-set-server=utf8
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ mysql -uroot test -e &#39;show global variables like &amp;quot;character_set%&amp;quot;; show variables like &amp;quot;character_set%&amp;quot;&#39;
+--------------------------+----------------------------+
| Variable_name            | Value                      |
+--------------------------+----------------------------+
| character_set_client     | utf8                       |
| character_set_connection | utf8                       |
| character_set_database   | utf8                       |
| character_set_filesystem | binary                     |
| character_set_results    | utf8                       |
| character_set_server     | utf8                       |
| character_set_system     | utf8                       |
| character_sets_dir       | /usr/share/mysql/charsets/ |
+--------------------------+----------------------------+
+--------------------------+----------------------------+
| Variable_name            | Value                      |
+--------------------------+----------------------------+
| character_set_client     | utf8                       |
| character_set_connection | utf8                       |
| character_set_database   | utf8                       |
| character_set_filesystem | binary                     |
| character_set_results    | utf8                       |
| character_set_server     | utf8                       |
| character_set_system     | utf8                       |
| character_sets_dir       | /usr/share/mysql/charsets/ |
+--------------------------+----------------------------+
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;rails-activerecord-ã‹ã‚‰æ¥ç¶šã™ã‚‹å ´åˆ:92573dc8333c8459780952b1c4bbdcda&#34;&gt;Railsï¼ˆActiveRecordï¼‰ã‹ã‚‰æ¥ç¶šã™ã‚‹å ´åˆã€€&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;db:
  encoding: &amp;quot;utf8mb4&amp;quot; # SET NAMES &amp;quot;utf8mb4&amp;quot;ã¨ç­‰ä¾¡
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ã•ã‚‰ã«ã€&lt;code&gt;SET NAMES utf8mb4&lt;/code&gt;ã¯ä»¥ä¸‹å…¨ã¦ã‚’å®Ÿè¡Œã—ãŸå ´åˆã¨ç­‰ä¾¡&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-sql&#34;&gt;SET character_set_client = utf8mb4;
SET character_set_results = utf8mb4;
SET character_set_connection = utf8mb4;
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;utf8ãªã‚«ãƒ©ãƒ ã®æ–‡å­—åˆ—æ¤œç´¢:92573dc8333c8459780952b1c4bbdcda&#34;&gt;utf8ãªã‚«ãƒ©ãƒ ã®æ–‡å­—åˆ—æ¤œç´¢&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;utf8mb4ãªã‚«ãƒ©ãƒ ã«ã¯ã€utf8mb4ã§æ¥ç¶šã—ã¦insertã™ã‚‹ã“ã¨&lt;/li&gt;
&lt;li&gt;utf8ãªã‚«ãƒ©ãƒ ã«ã¯ã€utf8ã§ã‚‚utf8mb4ã§ã‚‚ã©ã¡ã‚‰ã§insertã—ã¦ã‚‚selectã—ã¦ã‚‚å•é¡Œãªã„&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ mysql -uroot test -e &#39;set names &amp;quot;utf8mb4&amp;quot;; select * from user2 where name2 like &amp;quot;%ã ã‚ˆ%&amp;quot; limit 3&#39;
+----+----------------+------------------+
| id | name1          | name2            |
+----+----------------+------------------+
|  1 | firstã ã‚ˆâ™¬     | firstã ã‚ˆâ™¬       |
|  2 | secondã ã‚ˆ     | secondã ã‚ˆ????   |
|  3 | secondã ã‚ˆ?    | secondã ã‚ˆâ™¨      |
+----+----------------+------------------+
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ mysql -uroot test -e &#39;set names &amp;quot;utf8mb4&amp;quot;; select * from user2 where name2 like &amp;quot;%ã ã‚ˆâ™¨&amp;quot; limit 3&#39;
+----+--------------------+---------------------+
| id | name1              | name2               |
+----+--------------------+---------------------+
|  3 | secondã ã‚ˆ?        | secondã ã‚ˆâ™¨          |
|  8 | ãƒ†ã‚¹ãƒˆã ã‚ˆâ™¬        | ãƒ†ã‚¹ãƒˆã ã‚ˆâ™¨          |
| 13 | ãƒ†ã‚¹ãƒˆã ã‚ˆâ™¬        | ãƒ†ã‚¹ãƒˆã ã‚ˆâ™¨          |
+----+--------------------+---------------------+
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ãŸã ã—ã€utf8mb4ãªã‚«ãƒ©ãƒ ã«å¯¾ã—ã¦4ãƒã‚¤ãƒˆæ–‡å­—åˆ—ã‚’æŠ•ã’ã‚‹ã¨ã€utf8ã§æ¥ç¶šã—ãŸæ™‚ã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ mysql -uroot test -e &#39;set names &amp;quot;utf8&amp;quot;; select * from user2 where name2 like &amp;quot;%ã ã‚ˆâ™¨&amp;quot; limit 3&#39;
ERROR 1267 (HY000) at line 1: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8_general_ci,COERCIBLE) for operation &#39;like&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ãªã®ã§ã€ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦utf8mb4ãŒæ ¼ç´ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹DBã«å¯¾ã—ã¦ã¯ã€utf8mb4ã§å¿…ãšæ¥ç¶šã™ã‚‹ã“ã¨ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ mysql -uroot test -e &#39;set names &amp;quot;utf8mb4&amp;quot;; select * from user2 where name2 like &amp;quot;%ã ã‚ˆâ™¨&amp;quot; limit 3&#39;
+----+--------------------+---------------------+
| id | name1              | name2               |
+----+--------------------+---------------------+
|  3 | secondã ã‚ˆ?        | secondã ã‚ˆâ™¨          |
|  8 | ãƒ†ã‚¹ãƒˆã ã‚ˆâ™¬        | ãƒ†ã‚¹ãƒˆã ã‚ˆâ™¨          |
| 13 | ãƒ†ã‚¹ãƒˆã ã‚ˆâ™¬        | ãƒ†ã‚¹ãƒˆã ã‚ˆâ™¨          |
+----+--------------------+---------------------+
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ5-1ã®å ´åˆ:92573dc8333c8459780952b1c4bbdcda&#34;&gt;ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ5.1ã®å ´åˆ&lt;/h3&gt;

&lt;p&gt;my.cnfã‚„mysqlã‚³ãƒãƒ³ãƒ‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«&lt;code&gt;client.default_character_set=utf8mb4&lt;/code&gt;ã¯æŒ‡å®šã§ããªã„&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ mysql --default-character-set=utf8mb4 -h 192.168.1.164 -uroot test -e &#39;select * from user&#39;
mysql: Character set &#39;utf8mb4&#39; is not a compiled character set and is not specified in the &#39;/usr/share/mysql/charsets/Index.xml&#39; file
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ãŸã ã—ã€SQLã§ã®&lt;code&gt;set names utf8mb4&lt;/code&gt;ã®æŒ‡å®šã¯æœ‰åŠ¹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ mysql -h 192.168.1.164 -uroot test -e &#39;set names utf8mb4; select * from user&#39;
+----+------------+---------------+
| id | name1      | name2         |
+----+------------+---------------+
| 14 | ãƒ†ã‚¹ãƒˆ  | ãƒ†ã‚¹ãƒˆ???? |
| 15 | ãƒ†ã‚¹ãƒˆ? | ãƒ†ã‚¹ãƒˆâ™¨ |
+----+------------+---------------+
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ActiveRecordç­‰ã§mysql2ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€encodingã«utf8mb4ã‚’æŒ‡å®šã™ã‚‹ã¨ä¾‹å¤–ãŒèµ·ãã‚‹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;Character set &#39;utf8mb4&#39; is not a compiled character set and is not specified in the &#39;/usr/share/mysql/charsets/Index.xml&#39; file
/home/yoshida/hoge/vendor/bundle/ruby/2.0.0/gems/mysql2-0.3.13/lib/mysql2/client.rb:58:in `connect&#39;: Can&#39;t initialize character set utf8mb4 (path: /usr/share/mysql/charsets/) (Mysql2::Error)
        from /home/yoshida/hoge/vendor/bundle/ruby/2.0.0/gems/mysql2-0.3.13/lib/mysql2/client.rb:58:in `initialize&#39;
        from test_mysql.rb:3:in `new&#39;
        from test_mysql.rb:3:in `&amp;lt;main&amp;gt;&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ãªã®ã§ã€æ¥ç¶šæ™‚ã«set namesã™ã‚Œã°è‰¯ã„&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;require &#39;mysql2&#39;
client = Mysql2::Client.new(:host =&amp;gt; &amp;quot;localhost&amp;quot;, :username =&amp;gt; &amp;quot;root&amp;quot;, db: &#39;test&#39;)
client.query(&#39;SET NAMES utf8mb4&#39;)
puts client.query(&#39;SELECT * FROM user&#39;).map { |r| r[&#39;name2&#39;] }
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ ruby test.rb
[&amp;quot;ãƒ†ã‚¹ãƒˆ????&amp;quot;, &amp;quot;ãƒ†ã‚¹ãƒˆğŸŒ¸&amp;quot;]
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;å‚è€ƒ:92573dc8333c8459780952b1c4bbdcda&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://dev.mysql.com/doc/refman/5.1/ja/charset-database.html&#34;&gt;MySQL ::   MySQL 5.1 ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒãƒ‹ãƒ¥ã‚¢ãƒ« :: 9.3.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ã‚»ãƒƒãƒˆãŠã‚ˆã³ç…§åˆé †åº&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://d.hatena.ne.jp/maeyan/20090811/1250008156&#34;&gt;MySQLã§utf8ã‚’æ‰±ã†å ´åˆã€‚ - Ã—Ã—Ã—Diary&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://apps.timwhitlock.info/emoji/tables/unicode&#34;&gt;Emoji unicode characters for use on the web&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Scalaã®ORMapperã®Squerylã‚’è©¦ã—ã¦ã¿ã¦ãƒãƒã£ãŸï¼“ã¤ã®ã“ã¨</title>
      <link>http://blog.restartr.com/2011/08/16/3-things-that-i-was-in-trouble-using-squeryl</link>
      <pubDate>Tue, 16 Aug 2011 08:00:15 +0900</pubDate>
      
      <guid>http://blog.restartr.com/2011/08/16/3-things-that-i-was-in-trouble-using-squeryl</guid>
      <description>&lt;p&gt;Scalaã®ORMã¨ã—ã¦Squerylã£ã¦ã®ãŒã‚ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://squeryl.org/index.html&#34;&gt;Squeryl - A Scala ORM for SQL Databases&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
ä½¿ã„æ–¹ã¯ä¸Šè¨˜ãƒªãƒ³ã‚¯å…ˆã‚’è¦‹ã‚Œã°ã ã„ãŸã„ã‚ã‹ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ã‚ã¨ã€&lt;a href=&#34;http://twitter.com/jugyo&#34;&gt;@jugyo&lt;/a&gt;ã•ã‚“ã®ãƒ–ãƒ­ã‚°ã«å°å…¥ã‚ãŸã‚Šã¯ã¾ã¨ã¾ã£ã¦ã„ã¾ã™ã—ã€ã¤ã¾ã¥ã„ãŸã‚‰GoogleGroupã§æ¤œç´¢ã™ã‚Œã°ä½•ã‹è¦‹ã¤ã‹ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚&lt;/p&gt;

&lt;p&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.twiwt.org/e/f34763&#34;&gt; Twiwt:Blog / jugyo : squeryl ã‚’è©¦ã™ &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.twiwt.org/e/7e40ce&#34;&gt;Twiwt:Blog / jugyo : Squeryl ã®ä½¿ã„æ–¹ - ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—, ãƒ¢ãƒ‡ãƒ«ã®å®šç¾©, ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://groups.google.com/group/squeryl/about&#34;&gt; Squeryl | Google Groups &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
ã•ã¦ã€ä»Šå›ã¯Twitterã£ã½ã„ã‚‚ã®ã‚’æƒ³å®šã—ã¦æ©Ÿèƒ½ã‚’è©¦ã—ã¦ã¿ãŸã®ã§ã™ãŒã€ï¼“ã¤ã»ã©ãƒãƒã£ãŸã¨ã“ã‚ã‚’è¨˜ã—ã¦ãŠãã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ç’°å¢ƒã¯Scala2.9.0.1ã€Sbt0.7.7ã€MySQL5.5ã€Squeryl0.9.4ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;ã‚½ãƒ¼ã‚¹ã¯gistã«ç™»éŒ²ã€‚ãã‚Œã‚’æœ¬æ–‡æœ«å°¾ã«ã‚‚æ²è¼‰ã—ã¦ãŠãã¾ã—ãŸã€‚&lt;/p&gt;

&lt;p&gt;&lt;h3&gt;ï¼‘ï¼ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¼ã‚­ãƒ¼ã®æŒ‡å®šã§ã®åµŒã‚Šã©ã“ã‚&lt;/h3&gt;
1ã¤ã®ã‚«ãƒ©ãƒ ãŒPKã¨ãªã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚­ãƒ¼ãƒã®å ´åˆã€org.squeryl.KeyedEntity[T]ã‚’ç¶™æ‰¿ã—ã¦ä½¿ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-scala&#34;&gt;
class Users(id: Long, text: String) extends KeyedEntity[Long]

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;KeyedEntityã«ã¯idã¨ã„ã†ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã¦ã€ç¶™æ‰¿æ™‚ã«å‹ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€PKã®å‹ã«é©ç”¨ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»Šå›ã®å ´åˆã§ã‚ã‚Œã°Longå‹ã®PKã€Œidã€ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ãŸã ã—ã€ã“ã®å ´åˆã€PKã¯autoincrementedã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ã‚³ãƒ¼ãƒ‰çš„ã«ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«KeyedEntity[T]ã‚’ä½¿ã‚ãšSchemaç¶™æ‰¿æ™‚ã«å®šç¾©ã™ã‚‹ã®ã¨åŒç­‰ã«ãªã‚‹ã‚ã‘ã§ã™ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-scala&#34;&gt;
class Users(id: Long, text: String)

class Db extends Schema {

  val users = table[User](&amp;quot;users&amp;quot;)

  on(users)(u =&amp;gt; declare(

    u.id is (primaryKey, autoincremented))

}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ã“ã‚Œã¯çµæ§‹å›°ã‚Šã¾ã™ã€‚ãã‚“ãªå ´åˆã¯Schemaã‚’ç¶™æ‰¿ã™ã‚‹ã¨ãã«å®šç¾©ã‚’ä¸Šæ›¸ãã™ã‚Œã°OKã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-scala&#34;&gt;
class Users(id: Long, text: String) extends KeyedEntity[Long]

class Db extends Schema {

  val users = table[User](&amp;quot;users&amp;quot;)

  on(users)(u =&amp;gt; declare(

    u.id is (primaryKey))

}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ã“ã‚Œã¯Squerylã®GoogleGroupã«æ›¸ã„ã¦ã¾ã—ãŸã€‚&lt;/p&gt;

&lt;p&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://groups.google.com/forum/#!topic/squeryl/BTrKBwikMqs&#34;&gt;how to cancel &amp;ldquo;autoincremented&amp;rdquo; from KeyedEntity[T]&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;ï¼’ï¼DDLã®ã‚«ãƒ©ãƒ ã®é †ç•ªã®åµŒã‚Šã©ã“ã‚&lt;/h3&gt;
Db.printDdlã‚’å®Ÿè¡Œã—ãŸæ™‚ã«ã‚«ãƒ©ãƒ ã®é †ç•ªãŒäºˆæ¸¬ã§ãã¾ã›ã‚“ã€‚&lt;/p&gt;

&lt;p&gt;PKãŒæœ€åˆã«ãã‚‹ã®ã‹ã¨æ€ãˆã°ãã†ã§ã‚‚ãªã„ã¿ãŸã„ã€‚ã“ã“ã¯ç´°ã‹ãè¿½ã£ã¦ãªã„ã§ã™ãŒã€ã“ã‚Œã‚‚GoogleGroupã«ç­”ãˆãŒã‚ã‚Šã¾ã—ãŸã€‚&lt;/p&gt;

&lt;p&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://groups.google.com/forum/#!topic/squeryl/ZwiDf5Q-IUI&#34;&gt;CREATE TABLE columns in order of constructor arguments&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
ç­”ãˆã¨ã—ã¦ã¯ã€org.squeryl.internals.DatabaseAdapter:: writeCreateTableã‚ãŸã‚Šã‚’orverrideã—ã¦ãªã‚“ã¨ã‹ã—ã¦ãã‚Œã¨ã®ã“ã¨ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/max-l/Squeryl/blob/master/src/main/scala/org/squeryl/internals/DatabaseAdapter.scala#L255&#34;&gt;https://github.com/max-l/Squeryl/blob/master/src/main/scala/org/squeryl/internals/DatabaseAdapter.scala#L255&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ãªã‚“ã‹è‰¯ã„æ–¹æ³•ã¯ãªã„ã®â€¦&lt;/p&gt;

&lt;p&gt;ã¨ã‚Šã‚ãˆãšã€printDdlã—ãŸçµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€é †ç•ªã ã‘æ›¸ãæ›ãˆã¦ã€æ‰‹å‹•ã§ç›´æ¥DBã«ã‚¯ã‚¨ãƒªç™ºè¡Œã™ã‚Œã°ãªã‚“ã¨ã‹ãªã‚‹ã§ã—ã‚‡ã†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;h3&gt;ï¼“ï¼å¤–éƒ¨ã‚­ãƒ¼ã®åˆ©ç”¨ã§ã®ã¯ã¾ã‚Šã©ã“ã‚&lt;/h3&gt;
ï¼’ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«Relationã‚’è¨­å®šã—ã¦ã‹ã‚‰Db.createã—ãŸéš›ã€å¤–éƒ¨ã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œãªã„å•é¡ŒãŒã‚ã‚Šã¾ã—ãŸã€‚&lt;/p&gt;

&lt;p&gt;MySQLã¯5.5ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§å¤–éƒ¨ã‚­ãƒ¼ã«å¯¾å¿œã—ã¦ã„ãªã„è¨³ã§ã‚‚ãªã„ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;å•é¡Œã¯Adapterã®é¸å®šã«ã‚ã‚Šã¾ã—ãŸã€‚&lt;/p&gt;

&lt;p&gt;org.squeryl.adapter.MySQLAdapter&lt;/p&gt;

&lt;p&gt;ã‚’ã¤ã‹ã£ã¦ã„ãŸã®ã§ã™ãŒã€&lt;/p&gt;

&lt;p&gt;org.squeryl.adapter.MySQLInnoDBAdapter&lt;/p&gt;

&lt;p&gt;ã‚’ä½¿ãˆã°OKã§ã—ãŸã€‚&lt;/p&gt;

&lt;p&gt;æ ¹æœ¬ã®åŸå› ã¯ã€org.squeryl.adapter.MySQLAdapterã«&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-scala&#34;&gt;
override def supportsForeignKeyConstraints = false

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ã¨å®šç¾©ã—ã¦ã‚ã‚Šã€ä¸€æ–¹ã®org.squeryl.adapter.MySQLInnoDBAdapterã«ã¯&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-scala&#34;&gt;
override def supportsForeignKeyConstraints = true

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ã¨å®šç¾©ã—ã¦ã‚ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ã“ã®å€¤ãŒtrueã«ãªã£ã¦ã„ãªã„ã¨ForeignKeyã®åˆ¶ç´„ãŒDDLã«å«ã¾ã‚Œãªããªã£ã¦ã—ã¾ã†ã®ã§æ³¨æ„ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/max-l/Squeryl/blob/master/src/main/scala/org/squeryl/adapters/MySQLAdapter.scala#L75&#34;&gt;Docã‚³ãƒ¡ãƒ³ãƒˆã«ã‚‚æ›¸ã„ã¦ã‚ã‚‹&lt;/a&gt;ã®ã§æ³¨æ„ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;ä»¥ä¸Šã€Squerylã‚’å¼„ã£ã¦ã¿ã¦åµŒã£ãŸã“ã¨ã‚’ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚&lt;/p&gt;

&lt;p&gt;&lt;h3&gt;Squerylã®ä½¿ç”¨æ„Ÿ&lt;/h3&gt;
ã¡ã‚‡ã£ã¨å‰ã«Twitterã®StreamAPIã®ãƒ‡ãƒ¼ã‚¿ã‚’MySQLã«æ ¼ç´ã™ã‚‹ãŸã‚ã«Squerylã‚’ä½¿ã£ãŸã®ã¨ä»Šå›å°‘ã—å¼„ã£ã¦ã¿ãŸã ã‘ãªã®ã§ã¾ã ã¾ã çŸ¥ã‚‰ãªã„ã“ã¨ã ã‚‰ã‘ã§ã™ã€‚ä»–ã«ã‚‚æ©Ÿèƒ½çš„ã¯ãŸãã•ã‚“ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã—ã€APIã‚‚å‰²ã¨ãªã˜ã¿ã‚„ã™ã„ã®ã§è¤‡é›‘ã™ããªã„ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã®å ´åˆã«ã¯ç©æ¥µçš„ã«Squerylã‚’ä½¿ã£ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;em&gt;â€»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„æœ¬ä½“ã®ã‚½ãƒ¼ã‚¹ã‚’è¿½ã„ã‹ã‘ãŸã‚Šã—ãªãŒã‚‰ä½¿ã„æ–¹ã‚’å­¦ã¶ã®ã¯éå¸¸ã«æ¥½ã—ã„ã§ã™:)&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;ã§ã€ã‚½ãƒ¼ã‚¹ã¯ä»¥ä¸‹ã§ã™ã€‚&lt;/p&gt;

&lt;script src=&#34;https://gist.github.com/1146854.js&#34;&gt; &lt;/script&gt;
</description>
    </item>
    
  </channel>
</rss>